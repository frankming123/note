# Linux常用命令

<!-- TOC -->

- [Linux常用命令](#linux常用命令)
    - [网络](#网络)
        - [ip](#ip)
            - [ip netns](#ip-netns)
    - [虚拟化](#虚拟化)
        - [virsh](#virsh)
        - [qemu-img](#qemu-img)
            - [安装方式](#安装方式)
            - [使用方法](#使用方法)
    - [文件上传与下载](#文件上传与下载)
        - [rz,sz](#rzsz)
            - [安装方式](#安装方式-1)
            - [使用方法](#使用方法-1)
        - [aria2](#aria2)
        - [wget](#wget)
        - [uGet](#uget)
        - [axel](#axel)
            - [安装方式](#安装方式-2)
            - [使用方法](#使用方法-2)
        - [BCloud](#bcloud)
        - [mlDonkey](#mldonkey)

<!-- /TOC -->

## 网络

### ip

#### ip netns

ip netns是网络命名空间的管理工具

一个网络命名空间是逻辑上的网络协议栈的拷贝,它有自己的路由,防火墙规则以及网络设备

默认情况下,一个进程从它的父进程那继承网络命名空间.开始时所有进程都从init进程那共享同一个默认的网络命名空间

习惯上,一个网络命名空间是位于/var/run/netns/NAME的能被打开的一个文件.打开该文件的文件描述符即表示被选定的网络命名空间.只要该文件描述符是打开状态,那么对应的网络命名空间就是活跃的.此文件描述符可以与setns系统调用配合使用以改变一个进程的网络命名空间

- 语法

    list:显示所有的网络命名空间(在/var/run/netns目录下)

    add NAME:创建一个新的网络命名空间

    [all] delete [ NAME ]:删除网络命名空间

    [all] exec [ NAME ] cmd ...:在指定的网络命名空间中运行命令

## 虚拟化

### virsh

### qemu-img

qemu-img是QEMU的磁盘镜像管理工具,也是QEMU/KVM使用过程中一个比较重要的工具

#### 安装方式

一般来说,qemu-img包含在qemu这个虚拟化软件的套件中.在arch中,qemu软件包中就有qemu-img这个工具

#### 使用方法

- 语法

    qemu-img command [command options]

    command:

    1. check [-f fmt] [-r [leaks | all]] filename

        对磁盘镜像文件进行一致性检查,加上-r参数表示修复它

        目前仅支持"qcow2","qed","vdi"格式文件的检查

        参数-f指定文件的格式,如果不指定格式qemu-img会自动检测

    2. create [-f fmt] [-b backing_file] filename [size]

        创建一个名称为filename的磁盘镜像,大小为size,格式是fmt

        如果选定backing_file参数,那么该镜像只会记录与backing_file的差异.这种情况下无需指定size.backing_file是只读的,直到使用commit命令提交改动

        size参数默认单位是byte,也可以支持k,K,M,G,T等等

    3. commit [-f fmt] filename

        提交filename文件中的更改到后端支持镜像文件(创建时通过backing_file指定的)中去

    4. convert [-f fmt] [-O output_fmt] [-B backing_file] [-o options] filename [filename2 [...]] output_filename

        将fmt格式的filename镜像文件根据options选项转换为格式为output_fmt的名为output_filename的镜像文件.它支持不同格式的镜像文件之间的转换

        一般来说,输入文件格式fmt由qemu-img工具自动检测到,而输出格式output_fmt根据自己需要来指定,默认会被转化为raw文件格式

        使用backing_file来指定后端镜像,让生成的文件是cow的增量文件.这是必须让转换命令中指定的后端镜像与输入文件的后端镜像的内容是相同的(可以文件不同,格式不同)

    5. info [-f fmt] filename

        展示filename镜像文件的信息

    6. map [-f fmt] filename

        查看镜像文件filename的元数据信息,即文件各部分的映射关系

    7. snapshot [-l | -a snapshot | -c snapshot | -d snapshot ] filename

        -l:列出所有快照
        -a snapshot:让镜像文件使用某个快照
        -c snapshot:创建一个快照
        -d snapshot:删除一个快照

    8. rebase [-f fmt] [-u] -b backing_file [-F backing_fmt] filename

        改变镜像文件filename的后端镜像文件,只有qcow2和qed格式支持rebase命令

        使用backing_file作为后端镜像文件,backing_fmt作为后端镜像的格式

        它可以工作在两种模式下,默认是安全模式,qemu-img会比较原来的后端镜像与现在后端镜像的不同并进行合理的处理;另一个是非安全模式,通过"-u"参数指定,这种模式主要用于将后端镜像进行重命名或者移动了位置之后对前端镜像文件的修复处理

    9. resize [--shrink] [--preallocation=prealloc] filename [+ | -]size

        改变镜像文件的大小,"+"和"-"分别表示增加和减少镜像文件的大小

        当缩减镜像文件大小时,必须要有"--shrink"参数以表示用户知道缩减空间可能会造成数据丢失

        当扩大镜像文件大小时,可以使用"--preallocation"选项指定扩容的方式

- 示例

        ]# qemu-img check -f qcow2 centos7.0.qcow2

        ]# qemu-img create -f qcow2 -b rhel71.img  rhel72.qcow2

        ]# qemu-img convert my-vmware.vmdk my-kvm.img

        ]# qemu-img info rhel7.img

## 文件上传与下载

### rz,sz

rz和sz是Linux同Windows进行ZModem文件传输的命令行工具,可以很方便的上传和下载文件

#### 安装方式

在类Fedora系统上,rz和sz命令包括在lrzsz包中.该包位于base源中,与此同时还包括了rx,rb,sx,sb命令,分别是上传和下载的XModem和YModem实现

    ]# yum install lrzsz

#### 使用方法

- rz

    rz是上传命令.可直接在命令行下执行rz命令,会弹出上传文件的选择窗口,可以选择相关文件上传(不支持目录,需要打包)

        ]# rz

- sz

    sz是下载命令.可将需要下载的文件作为参数传递给sz命令(不支持目录,需要打包)

        ]# sz 123.txt

### aria2

### wget

### uGet

uGet是一款功能很丰富的下载管理器,拥有多线程下载,暂停/恢复和队列等功能

### axel

axel是一个从HTTP/ftp服务器下载文件的工具

#### 安装方式

在类Fedora系统中,axel收录在epel源中

    ]# yum install axel

#### 使用方法

- 语法

    axel [OPTIONS] url1 [url2] [url...]

    OPTIONS

        --max-speed=x, -s x:限制下载速度,单位为字节
        --num-connections=x, -n x:设置连接数
        --output=f , -o f:为下载的文件指定一个不同的名称,或放在不同的路径
        --search[=x], -S[x]:在服务器上搜索x个镜像站点同时下载文件(如果有镜像站点的话)
        --verbose:显示更多状态信息的细节
        --alternate, -a:显示一个额外的状态条
        --no-proxy, -N:如果开启代理,则不使用代理
        --header=x, -H x:添加额外的http报头,格式为"Header: Value"
        --user-agent=x, -U x:修改http报头中的User-Agent项,该项默认为"Axel"和版本,平台等信息
        --quiet, -q:不输出到标准输出
        --help, -h:显示帮助信息
        --version, -V:显示版本信息

- 示例

    下载cirros包,指定16个线程,显示各线程信息,存放为/tmp目录下的cirros.img

        ]# axel -n16 -o /tmp/cirros.img -a http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img

### BCloud

BCloud是百度云的非官方linux版本,下载地址:<https://github.com/XuShaohua/bcloud>

### mlDonkey

MLDonkey是一个GPL开源免费,跨平台(Linux,Solaris,Mac OS X,Windows以及MorphOS),多协议的P2P共享软件